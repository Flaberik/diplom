<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='index_style.css')}}" type="text/css">

    <meta charset="utf-8">
    {% if title %}
    <title>{{title}}</title>
    {% else %}
    <title>W</title>
    {% endif %}

    <script>
        <!--
        result = {{test|safe}};
        teachers = {{teachers|safe}};
        lessons = {{lessons|safe}};
        groups = {{groups|safe}};
        login = '{{user.login|safe}}';
        days = {1: 'ПН', 2: 'ВТ', 3: 'СР', 4: 'ЧТ', 5: 'ПТ', 6: 'СБ', 7: 'ВС'};

        function create_select(select_for, value) {

            if (select_for == 'teachers') {
                select_teacher = '<select name="teacher_select" id="teacher_select" style="width: 250px;"><option></option>';
                for (var i = 0; i < teachers.length; i++) {
                    if (teachers[i].teacher_name == value.teacher_name) {
                        select_teacher += '<option selected value="' + teachers[i].teacher_name + '">' + teachers[i].teacher_name + '</option>';
                    } else {
                        select_teacher += '<option value="' + teachers[i].teacher_name + '">' + teachers[i].teacher_name + '</option>'
                    }
                }
                return select_teacher + '</select>';
            } else if (select_for == 'lessons') {
                select_lesson = '<select name="lesson_select" id="lesson_select" style="width: 250px;"><option></option>';
                for (var i = 0; i < lessons.length; i++) {
                    if (lessons[i].lesson_name == value.lesson_name) {
                        select_lesson += '<option selected>' + lessons[i].lesson_name + '</option>';
                    } else {
                        select_lesson += '<option>' + lessons[i].lesson_name + '</option>'
                    }
                }
                return select_lesson + '</select>';
            } else if (select_for == 'groups') {
                select_group = '<select name="group_select" id="group_select" style="width: 250px;"><option></option>';
                for (var i = 0; i < groups.length; i++) {
                    if (groups[i].group_name == value.group_name) {
                        select_group += '<option selected value="'+groups[i].group_name+'">' + groups[i].group_name + '</option>';
                    } else {
                        select_group += '<option value="'+groups[i].group_name+'">' + groups[i].group_name + '</option>'
                    }
                }
                return select_group + '</select>';
            } else if (select_for == 'days') {
                select_day = '<select name="day_select" style="width: 150px;">';
                for (var i = 1; i <= 7; i++) {
                    if (days[i] == value.day_week) {
                        select_day += '<option selected>' + days[i] + '</option>';
                    } else {
                        select_day += '<option>' + days[i] + '</option>';
                    }
                }
                return select_day + '</select>';
            } else if (select_for == 'pair') {
                select_pair = '<select name="pair_select" style="width: 150px;">';
                for (var i = 1; i <= 6; i++) {
                    if (String(i) == value.pair) {
                        select_pair += '<option selected>' + String(i) + '</option>';
                    } else {
                        select_pair += '<option>' + String(i) + '</option>';
                    }
                }

                return select_pair + '</select>';
            }

            return '';
        }

        function check_fields(){
          var teacher_select = document.getElementById('teacher_select');
          var lesson_select = document.getElementById('lesson_select');
          var group_select = document.getElementById('group_select');
          if(teacher_select.value.length > 0 && lesson_select.value.length > 0 && group_select.value.length > 0){
             document.getElementById('newForm').submit();
          }
        }

        function func1(myD) {
            if (login != '') {
                var newForm = document.getElementById('newForm');
                var value = myD.value;
                chekbox = (value.denom == 1) ? '<input type="checkbox" checked name="denom" value="1"> Подмена' : '<input type="checkbox" name="denom" value="1"> Подмена';

                newForm.innerHTML =
                    '   {{ form.hidden_tag() }}     \n' +
                    '        <table style="border: 1px solid #C0C0C0">\n' +
                    '            <td>\n' +
                    '                <table>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    '                            Преподаватель:\n' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    create_select('teachers', value) +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    '                            Группа:\n' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    create_select('groups', value) +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    '                            Дисциплина:\n' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    create_select('lessons', value) +
                    '                        </td>\n' +
                    '\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    '                             <button name="Submit" onclick="check_fields()" value="Внести" style="width: 120px;">Внести</button>' +
                    '                            <button name="Submit" onclick="check_fields()" value="Удалить" style="width: 120px;">Удалить</button>' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                </table>\n' +
                    '            </td>\n' +
                    '            <td>\n' +
                    '                <table>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    '                            День:\n' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    create_select('days', value) +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    '                            Пара:\n' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    create_select('pair', value) +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    '                            Номер аудитории:\n' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    '                            <input type="text" name="num_room" value="" placeholder="" style="width: 150px;">\n' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                    <tr>\n' +
                    '                        <td>\n' +
                    chekbox +
                    //'                            <input type="checkbox" name="denom" value="1"> Подмена\n' +
                    '                        </td>\n' +
                    '                    </tr>\n' +
                    '                </table>\n' +
                    '            </td>\n' +
                    '        </table>\n' +
                    '';
            }

        }

        function select(result, days_enum, group_name, teacher_name) {

            clear_tabel();
            for (var i = 0; i < result[0].length; i++) {
                if (group_name.length > 1)
                    if (result[1][i].group_name == group_name) {
                        value = func(result[1][i].group_name, result[2][i].teacher_name, result[3][i].lesson_name, result[0][i].num_room,result[0][i].day_week,result[0][i].pair,result[0][i].denom);
                        fill_div(result[3][i].lesson_name, result[2][i].teacher_name, result[0][i].num_room, (days_enum[result[0][i].day_week] + result[0][i].pair), value)
                    }

                if (teacher_name.length > 1)
                    if (result[2][i].teacher_name == teacher_name) {
                        value = func(result[1][i].group_name, result[2][i].teacher_name, result[3][i].lesson_name, result[0][i].num_room,result[0][i].day_week,result[0][i].pair,result[0][i].denom);
                        fill_div(result[3][i].lesson_name, result[1][i].group_name, result[0][i].num_room, (days_enum[result[0][i].day_week] + result[0][i].pair), value)
                    }

            }
            //printInfo(document.getElementById('t1'));
        }

        function fill_div(par1, par2, par3, id, value) {
            var td;
            if (value.denom == 0)
              var td = document.getElementById(id+'_up');
            else if(value.denom == 1){
              var td = document.getElementById(id+'_down');
              td.style.borderTop = '1px solid #C0C0C0';
            }

            td.innerHTML = '';//result[3][i].lesson_name + '<br>' + result[2][i].teacher_name + ' ' + result[0][i].num_room;

            create_new_table(id, td, (par1 + '<br>' + par2 + ' ' + par3), value)
        }

        function printInfo(ele) {
            var openWindow = window.open('','','left=50,top=50,width=800,height=640,toolbar=0,scrollbars=1,status=0');
            var prtCss = "<link rel=\"stylesheet\" href=\"{{ url_for('static', filename='index_style.css')}}\" type=\"text/css\">";
            openWindow.document.write(prtCss);
            openWindow.document.write(ele.innerHTML);
            openWindow.document.close();
            openWindow.focus();
            openWindow.print();
            openWindow.close();
        }

        function clear_tabel() {
            for (var i = 1; i <= 5; i++) {
                for (var j = 1; j <= 5; j++) {
                    var down = document.getElementById(String(j) + String(i)+'_down');
                    var up = document.getElementById(String(j) + String(i)+'_up');
                    down.style.borderTop = '';
                    create_new_table((String(j) + String(i)), down, '', func('','','','',days[j],i));
                    create_new_table((String(j) + String(i)), up, '&emsp;&emsp;<br>&emsp;&emsp;<br>&emsp;&emsp;', func('','','','',days[j],i));
                }
            }
        }

        function func(group,teacher,lesson,num_room,day_week,pair,denom){
            value = {
                'group_name': group,
                'teacher_name': teacher,
                'lesson_name': lesson,
                'num_room': num_room,
                'day_week': day_week,
                'pair': pair,
                'denom': denom
            };
            return value;
        }

        function create_new_table(id, parent, text, value) {
            //var newD = document.createElement("div");
            parent.innerHTML = text;

            //newD.id = (id + "div");
            parent.value = value;

            parent.onclick = function () {
                func1(parent)
            };
            //parent.appendChild(newD);
        }

        //-->
    </script>
    {% extends "base.html" %}
</head>
<body>

{% block content %}
<center>
    <div  style="margin: 0 auto; padding-bottom: 5px;">
        <form action="" method="POST" id="newForm">
            {{ form.hidden_tag() }}
        </form>
    </div>
</center>
<form action="" method="POST" name="test" style="border: 1px solid #C0C0C0;">
    {{ form.hidden_tag() }}
    <table style="margin-bottom: 25px;" id="testPrint">
        <tr>
        <tr>
            <td>
                Группы:
            </td>
        </tr>
        <td>

            <select name="group_select" size="15" >
                {% for group in groups %}
                <option style="width: 120px;"
                        onclick="select({{test|safe}},{{days_enum|safe}}, '{{group.group_name}}', '')">
                    {{group.group_name}}
                </option>
                {% endfor %}
            </select>
        </td>
        <td>
            <div id="t1">
                <table>
                    <tr>
                        <td style="border: 1px solid #C0C0C0;">
                            ПН
                        </td>
                        <td style="border: 1px solid #C0C0C0;">
                            ВТ
                        </td>
                        <td style="border: 1px solid #C0C0C0;">
                            СР
                        </td>
                        <td style="border: 1px solid #C0C0C0;">
                            ЧТ
                        </td>
                        <td style="border: 1px solid #C0C0C0;">
                            ПТ
                        </td>
                    </tr>
                    {%for row in range(5) %}
                    {% for col in range(5) %}

                    <td class="td" >
                        <table>
                          <tr>
                            <td id="{{(col+1)|string + (row+1)|string}}_up">&emsp;&emsp;<br>&emsp;&emsp;<br>&emsp;&emsp;<br>&emsp;&emsp;</td>
                          </tr>
                          <tr>
                            <td id="{{(col+1)|string + (row+1)|string}}_down"></td>
                          </tr>
                        </table>
                    </td>
                    {% endfor %}
                    <tr></tr>
                    {% endfor %}
                </table>
            </div>
        </td>
        <td>
            <select name="teacher_select" size="15">
                {% if teachers %}
                {% for teacher in teachers %}
                <option style="width: 120px;"
                        onclick="select({{test|safe}},{{days_enum|safe}},'' , '{{teacher.teacher_name}}')">
                    {{teacher.teacher_name}}
                </option>
                {% endfor %}
                {% endif %}
            </select>
        </td>
        </tr>
    </table>
</form>
{% endblock %}
</body>
</html>
