<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


    <meta charset="utf-8">
    {% if title %}
    <title>{{title}}</title>
    {% else %}
    <title>W</title>
    {% endif %}

    <script>
        <!--
        result = {{test|safe}};
        teachers = {{teachers|safe}};
        lessons = {{lessons|safe}};
        groups = {{groups|safe}};
        days = {1: 'ПН', 2: 'ВТ', 3: 'СР', 4: 'ЧТ', 5: 'ПТ', 6: 'СБ', 7: 'ВС'};

        function create_select(select_for, value) {
/*            console.log(value.teacher_name);
            console.log(value.lesson_name);
            console.log(value.group_name);*/

            if (select_for == 'teachers') {
                select_teacher = '<select name="teacher_select" style="width: 250px;"><option></option>';
                for (var i = 0; i < teachers.length; i++) {
                    if (teachers[i].teacher_name == value.teacher_name) {
                        select_teacher += '<option selected>' + teachers[i].teacher_name + '</option>';
                    } else {
                        select_teacher += '<option>' + teachers[i].teacher_name + '</option>'
                    }
                }
                return select_teacher + '</select>';
            } else if (select_for == 'lessons') {
                select_lesson = '<select name="lesson_select" style="width: 250px;"><option></option>';
                for (var i = 0; i < lessons.length; i++) {
                    if (lessons[i].lesson_name == value.lesson_name) {
                        select_lesson += '<option>' + lessons[i].lesson_name + '</option>';
                    } else {
                        select_lesson += '<option>' + lessons[i].lesson_name + '</option>'
                    }
                }
                return select_lesson + '</select>';
            } else if (select_for == 'groups') {
                select_group = '<select name="group_select" style="width: 250px;"><option></option>';
                for (var i = 0; i < groups.length; i++) {
                    if (groups[i].group_name == value.group_name) {
                        select_group += '<option selected>' + groups[i].group_name + '</option>';
                    } else {
                        select_group += '<option>' + groups[i].group_name + '</option>'
                    }
                }
                return select_group + '</select>';
            } else if (select_for == 'days') {
                select_day = '<select name="day_select" style="width: 150px;">';
                for (var i = 1; i <= 7; i++) {
                    if (days[i] == value.day_week) {
                        select_day += '<option selected>' + days[i] + '</option>';
                    } else {
                        select_day += '<option>' + days[i] + '</option>';
                    }
                }
                return select_day + '</select>';
            } else if (select_for == 'pair') {
                select_pair = '<select name="pair_select" style="width: 150px;">';
                for (var i = 1; i <= 6; i++) {
                    if (String(i) == value.pair) {
                        select_pair += '<option selected>' + String(i) + '</option>';
                    } else {
                        select_pair += '<option>' + String(i) + '</option>';
                    }
                }

                return select_pair + '</select>';
            }

            return '';
        }

        function func1(id) {
            var myD = document.getElementById(id);
            console.log(id);
            var newForm = document.getElementById('newForm');
            var value = myD.value;

            //if(value.teacher_name = '{% for teacher in teachers %}{{teacher_name}}{%endfor%}')

            newForm.innerHTML =
                '   {{ form.hidden_tag() }}     \n' +
                '        <table style="border: 1px solid #C0C0C0">\n' +
                '            <td>\n' +
                '                <table>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            Преподаватель:\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                create_select('teachers',value) +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            Группа:\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                create_select('groups',value)+
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            Дисциплина:\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                create_select('lessons',value)+
                '                        </td>\n' +
                '\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            <input name="submit" type="submit" value="Внести" style="width: 250px;">\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                </table>\n' +
                '            </td>\n' +
                '            <td>\n' +
                '                <table>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            День:\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                create_select('days', value) +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            Пара:\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                create_select('pair',value) +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            Номер аудитории:\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            <input type="text" name="num_room" value="" placeholder="" style="width: 150px;">\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                    <tr>\n' +
                '                        <td>\n' +
                '                            <input type="checkbox" name="che" value=""> Подмена\n' +
                '                        </td>\n' +
                '                    </tr>\n' +
                '                </table>\n' +
                '            </td>\n' +
                '        </table>\n' +
                '';
            /*                '<form action="" method="POST" style="border: 1px solid #C0C0C0;">\n' +
                            '     {{ form.hidden_tag() }} ' +
                            '     <table>' +
                            '     </table>' +
                            '</form>\n';*/
            //console.log(myD.id);

        }

        function select(result, days_enum, group_name, teacher_name) {

            clear_tabel();
            for (var i = 0; i < result[0].length; i++) {
                if (group_name.length > 1)
                    if (result[1][i].group_name == group_name) {
                        value = func(result[1][i].group_name, result[2][i].teacher_name, result[3][i].lesson_name, result[0][i].num_room,result[0][i].day_week,result[0][i].pair,result[0][i].denom);
                        fill_div(result[3][i].lesson_name, result[2][i].teacher_name, result[0][i].num_room, (days_enum[result[0][i].day_week] + result[0][i].pair), value)
                    }

                if (teacher_name.length > 1)
                    if (result[2][i].teacher_name == teacher_name) {
                        value = func(result[1][i].group_name, result[2][i].teacher_name, result[3][i].lesson_name, result[0][i].num_room,result[0][i].day_week,result[0][i].pair,result[0][i].denom);
                        fill_div(result[3][i].lesson_name, result[1][i].group_name, result[0][i].num_room, (days_enum[result[0][i].day_week] + result[0][i].pair), value)
                    }
                console.log(result[0][i].denom)
            }
        }

        function fill_div(par1, par2, par3, id, value) {
            var myD = document.getElementById(id+'_up');
            myD.innerHTML = '';//result[3][i].lesson_name + '<br>' + result[2][i].teacher_name + ' ' + result[0][i].num_room;

            create_new_table(id, myD, (par1 + '<br>' + par2 + ' ' + par3), value)
        }

        function printInfo(ele) {
            var openWindow = window.open("", "title", "attributes");
            openWindow.document.write(ele.innerHTML);
            openWindow.document.close();
            openWindow.focus();
            openWindow.print();
            openWindow.close();
        }

        function clear_tabel() {
            for (var i = 1; i <= 5; i++) {
                for (var j = 1; j <= 5; j++) {
                    var down = document.getElementById(String(j) + String(i)+'_down');
                    var up = document.getElementById(String(j) + String(i)+'_up');
                    down.innerHTML = '';
                    up.innerHTML = '';
                    //create_new_table((String(j) + String(i)), down, '', func('','','','',days[j],i));
                    //create_new_table((String(j) + String(i)), up, '', func('','','','',days[j],i));
                }
            }
        }

        function func(group,teacher,lesson,num_room,day_week,pair,denom){
            value = {
                'group_name': group,
                'teacher_name': teacher,
                'lesson_name': lesson,
                'num_room': num_room,
                'day_week': day_week,
                'pair': pair,
                'denom': denom
            };
            return value;
        }

        function create_new_table(id, parent, text, value) {
            var newD = document.createElement("div");
            newD.innerHTML = text;
            newD.id = (id + "div");
            newD.value = value;

            newD.onclick = function () {
                func1(newD.id)
            };
            parent.appendChild(newD);
        }

        //-->
    </script>
</head>
<body>

<style>
    .tb {
        border: 1px solid #C0C0C0;
    }

    .tr {
        border: 1px solid #C0C0C0;
    }

    .th {
        border: 1px solid #C0C0C0;
    }

    .td {
        width: 150px;
        height: 50px;
        border: 1px solid #C0C0C0;
    }

    table {
        margin: 0 auto;
    }

    th {
        text-align: center;
    }

    td {
        padding: 2px;

    }

    tr {
        vertical-align: top;
        align: center;
        text-align: center;
    }
</style>

{% extends "base.html" %}
{% block content %}

<center>
    <div  style="margin: 0 auto; padding-bottom: 5px;">
        <form action="" method="POST" id="newForm">
            {{ form.hidden_tag() }}
        </form>
    </div>
</center>
<form action="" method="POST" name="test" style="border: 1px solid #C0C0C0;">
    {{ form.hidden_tag() }}
    <table style="margin-bottom: 25px;">
        <tr>
        <tr>
            <td>
                Группы:
            </td>
        </tr>
        <td>

            <select name="group_select" size="15" >
                {% for group in groups %}
                <option style="width: 120px;"
                        onclick="select({{test|safe}},{{days_enum|safe}}, '{{group.group_name}}', '')">
                    {{group.group_name}}
                </option>
                {% endfor %}
            </select>
        </td>
        <td>
            <div id="t1">
                <table>
                    <tr>
                        <td style="border: 1px solid #C0C0C0;">
                            ПН
                        </td>
                        <td style="border: 1px solid #C0C0C0;">
                            ВТ
                        </td>
                        <td style="border: 1px solid #C0C0C0;">
                            СР
                        </td>
                        <td style="border: 1px solid #C0C0C0;">
                            ЧТ
                        </td>
                        <td style="border: 1px solid #C0C0C0;">
                            ПТ
                        </td>
                    </tr>
                    {%for row in range(5) %}
                    {% for col in range(5) %}

                    <td class="td" id="{{(col+1)|string + (row+1)|string}}">

                    </td>
                    {% endfor %}
                    <tr></tr>
                    {% endfor %}
                </table>
            </div>
        </td>
        <td>
            <select name="teacher_select" size="15">
                {% if teachers %}
                {% for teacher in teachers %}
                <option style="width: 120px;"
                        onclick="select({{test|safe}},{{days_enum|safe}},'' , '{{teacher.teacher_name}}')">
                    {{teacher.teacher_name}}
                </option>
                {% endfor %}
                {% endif %}
            </select>
        </td>
        </tr>
    </table>
</form>
{% endblock %}
</body>
</html>
